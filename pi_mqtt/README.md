# 基于MQTT协议的树莓派设备监控平台设计与实现

## 立题依据

随着经济社会的不停发展，智能化越来越普及，智能设备在现实生活中也得到越来越多的推广。这些智能设备在日常生活中起到了非常重要的作用，给人们带来许多便利。而树莓派这个东西的出现无疑降低了创客这一职业的门槛，让人们进行智能设备的开发变得触手可及。
树莓派是一款基于ARM的微型电脑主板，以SD/MicroSD卡为内存硬盘，卡片主板周围有1/2/4个USB接口和一个10/100 以太网接口（A型没有网口），可连接键盘、鼠标和网线，同时拥有视频模拟信号的电视输出接口和HDMI高清视频输出接口，以上部件全部整合在一张仅比信用卡稍大的主板上，具备所有PC的基本功能只需接通电视机和键盘，就能执行如电子表格、文字处理、玩游戏、播放高清视频等诸多功能。 Raspberry Pi B款只提供电脑板，无内存、电源、键盘、机箱或连线。
树莓派在工业物联网的应用分析上的优势主要有以下几点：
1.模块性价比极高，量小时比定制硬件的成本要低；
2.开发灵活，出 Demo 原型速度快；
3.ARM 主机定位，和目前 ARM 工控技术方面匹配。
但是缺点也很明显：
1.无板载 Flash/eMMC ，需要 SD 卡启动， SD 卡里面烧录镜像（ bootloader 、 Kernel 、文件系统），容易造成接触不良导致设备无法正常启动；
2.模块支持的温度范围是 0~50℃ ，过高或过低温度下会导致树莓派不能正常工作；
3.供电需要使用 USB Type-C 线，模块供电需要底板或者其它电源通过USB线连接。
针对上诉的这些缺点，监控系统信息的运维就成了一大难题，针对这点国内外有着两派不同的考虑：国内爱好者圈主要依靠流行的宝塔面板之类的面板工具，通过简单的一键安装命令傻瓜式部署，技术上大多使用python和shell；公司的运行会使用比如zabbix这类知名工具或者使用ASP.NET开发自己使用的系统；国外的Linux/Unix运维上相对国内比较固定的单面板模式，更希望使用性能更好，效率更高的语音做二次开发，比如基于go语言的docker，基于Rust语言（由 Mozilla 开发，不需要gc也能做到内存安全的语言）的Rocket框架开发等，其中docker的开发无论国内还是国外都是相当认可和使用的。

## 研究内容

本系统为解决树莓派容易接触不良或温度因素导致的不稳定这一点而设计，基于Linux系统，采用上位机ASP.NET Core下位机Golang的方式，部署使用的docker，设计出一种便于部署的Linux平台监控系统。该系统能够使用pc或者手机设备，通过阿里云部署docker镜像和MQTT服务器，实时监控树莓派下位机的运行状态，并且可以在这些设备上进行一些简单的操作，从而达到远程运维的目的。

## 设计方案及思路

1. 解决痛点：对于物联网环境下多个终端设备的同时远程监控。
2. 主要功能模块：分为系统运行时间、登录用户数、系统负载、cpu信息（cpu核心数、cpu个数、cpu线程数）、存储设备信息（容量信息、inode节点信息、分区类型信息）内存信息（内存使用率、总内存）、GPIO控制监控、登录和设置界面构成。
3. 技术实现：
  - 前端框架：基于Vue.js的Uniapp移动端开发。
  - 后端框架：下位机Golang + eclipse/paho.mqtt.golang；上位机Asp.net Core+docker
  - MQTT服务器：EMQ X Broker
  - 监控功能脚本：Shell
  - 数据库：mysql